<!DOCTYPE html>
<html>
<head>
    <title>RequireJS &mdash; RingCentral&trade; Platform</title>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="common.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
</head>
<body>

<div class="container">

    <h1>
        <a href="index.html" id="logo"></a>
    </h1>

    <hr>

    <h4>RingCentral JS SDK Properties</h4>
    <p id="report"></p>

    <hr>

    <p class="text-center text-muted">
        &copy; 1999 &ndash; <span id="date"></span> RingCentral&trade;, Inc. All rights reserved.
        <script> document.getElementById('date').innerHTML = (new Date()).getFullYear().toString(); </script>
    </p>

</div>

<script type="text/javascript" src="https://unpkg.com/whatwg-fetch@3.0.0/dist/fetch.umd.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
<script src="https://unpkg.com/requirejs@2.3.6/require.js" type="text/javascript"></script>
<script type="text/javascript">

    //window.fetch = null;

    requirejs.config({
        paths: {
            'ringcentral': '../node_modules/@ringcentral/sdk/dist/ringcentral',
            'ringcentral-subscriptions': '../node_modules/@ringcentral/subscriptions/dist/ringcentral-subscriptions',
            'pubnub': 'https://unpkg.com/pubnub@4.21.6/dist/web/pubnub',
        }
    });

    require(['ringcentral', 'ringcentral-subscriptions'], function(sdkNS, subscriptionsNS) {

        var Subscriptions = subscriptionsNS.Subscriptions;
        var SDK = sdkNS.SDK;
        var sdk = new SDK({server: SDK.server.sandbox});
        var subscription = new Subscriptions({sdk: sdk});

        sdk.platform().get('/restapi/v1.0', null, {skipAuthCheck: true})
                .then(function(apiResponse) { return apiResponse.json(); })
                .then(function(data) {

                    document.getElementById('report').innerHTML = [
                        'RingCentral version: ' + SDK.version,
                        'API version: ' + data.versionString,
                        'PUBNUB version: ' + subscription.getPubNub().toString(),
                        'Promise native: ' + (Promise.toString().trim() == 'function Promise() { [native code] }'),
                        'Fetch native: ' + (sdk.externals().fetch.toString().trim() == 'function fetch() { [native code] }'),
                        'Root scope is not poisoned: ' + (window.RingCentral == undefined)
                    ].join('<br>');

                })
                .catch(function(e) {
                    alert(e.message + '\n\n' + e.stack);
                    console.error(e.message + '\n\n' + e.stack);
                });

    });

</script>

</body>
</html>
